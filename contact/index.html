
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF to Image Converter</title>
    <meta name="description" content="Convert PDF pages to images (PNG, JPG, WebP) directly in your browser. Select pages, rotate, flip, and download as a ZIP file. No uploads required.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#da3f0b',
                            '600': '#c23207',
                            '700': '#a52a05'
                        }
                    },
                    keyframes: {
                       'spin': {
                           'from': { transform: 'rotate(0deg)' },
                           'to': { transform: 'rotate(360deg)' },
                       },
                       'fade-in': {
                           'from': { opacity: '0' },
                           'to': { opacity: '1' },
                       },
                    },
                    animation: {
                        'spin-slow': 'spin 1.5s linear infinite',
                        'fade-in': 'fade-in 0.5s ease-out forwards',
                    },
                }
            }
        }
    </script>
    <!-- PDF.js and JSZip libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.3.136/pdf.min.mjs" type="module"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .page-card-checkbox:checked + .page-card-content {
            box-shadow: 0 0 0 3px #da3f0b;
        }
        .group:hover .page-actions {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div id="app-container" class="min-h-screen flex flex-col items-center justify-center p-4">
        
        <!-- Uploader View -->
        <div id="uploader-view" class="w-full max-w-xl">
            <div class="bg-white rounded-xl shadow-md text-center p-8 lg:p-12 border-2 border-dashed border-slate-300 hover:border-primary transition-colors duration-300">
                <div id="drop-zone" class="flex flex-col items-center justify-center space-y-4">
                    <svg class="w-16 h-16 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                    </svg>
                    <h2 class="text-2xl font-bold text-slate-700">Drop your PDF here</h2>
                    <p class="text-slate-500">or</p>
                    <button id="file-select-btn" type="button" class="bg-primary text-white font-semibold px-6 py-3 rounded-lg hover:bg-primary-600 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                        Select a file
                    </button>
                    <input type="file" id="file-input" class="hidden" accept=".pdf">
                    <p class="text-xs text-slate-400 pt-4">All processing is done in your browser. No files are uploaded.</p>
                </div>
            </div>
        </div>

        <!-- Editor View -->
        <div id="editor-view" class="hidden w-full max-w-7xl animate-fade-in">
             <!-- Controls Header -->
            <header class="bg-white rounded-xl shadow-md p-4 mb-6 sticky top-4 z-10">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <button id="reset-btn" class="text-sm font-medium text-slate-600 hover:text-primary transition-colors"> &larr; Convert another file</button>
                    
                    <div class="flex flex-wrap items-center gap-x-4 gap-y-2">
                        <div>
                           <label for="format-select" class="text-xs font-medium text-slate-500">Format</label>
                           <select id="format-select" class="text-sm rounded-md border-slate-300 focus:ring-primary focus:border-primary bg-white p-1 pr-7">
                               <option value="image/png">PNG</option>
                               <option value="image/jpeg">JPG</option>
                               <option value="image/webp">WEBP</option>
                           </select>
                        </div>
                        <div id="quality-control" class="hidden">
                           <label for="quality-slider" class="text-xs font-medium text-slate-500">Quality: <span id="quality-value">0.92</span></label>
                           <input id="quality-slider" type="range" min="0.1" max="1" step="0.01" value="0.92" class="w-24 h-1 align-middle accent-primary">
                        </div>
                         <div>
                           <label for="scale-select" class="text-xs font-medium text-slate-500">Resolution</label>
                           <select id="scale-select" class="text-sm rounded-md border-slate-300 focus:ring-primary focus:border-primary bg-white p-1 pr-7">
                               <option value="1">1x (Normal)</option>
                               <option value="1.5">1.5x (High)</option>
                               <option value="2">2x (Ultra)</option>
                           </select>
                        </div>
                    </div>

                    <div class="flex items-center gap-2">
                         <button id="download-selected-btn" disabled class="text-sm font-semibold text-primary border border-primary px-4 py-2 rounded-lg hover:bg-primary/10 disabled:opacity-50 disabled:cursor-not-allowed transition">Download Selected</button>
                         <button id="download-all-btn" disabled class="text-sm font-semibold bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition">Download All</button>
                    </div>
                </div>
            </header>

            <!-- Page Previews -->
            <div id="pages-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
                <!-- Page cards will be injected here -->
            </div>
        </div>

        <!-- Loader Overlay -->
        <div id="loader-overlay" class="hidden fixed inset-0 bg-slate-900/50 flex flex-col items-center justify-center z-50 transition-opacity">
            <div class="bg-white rounded-lg shadow-xl p-6 flex items-center gap-4">
                <svg class="animate-spin-slow h-8 w-8 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                <span id="loader-text" class="text-slate-600 font-medium">Processing PDF...</span>
            </div>
        </div>
    </div>

    <!-- Template for a single page card -->
    <template id="page-card-template">
        <div class="page-card group relative aspect-[_8.5_/_11_] animate-fade-in" data-page-num="">
            <label class="cursor-pointer">
                <input type="checkbox" class="page-card-checkbox absolute top-2 left-2 z-10 h-5 w-5 rounded border-slate-400 text-primary focus:ring-primary" checked>
                <div class="page-card-content bg-white rounded-lg shadow-md overflow-hidden h-full border-2 border-transparent">
                     <img src="" alt="Page Preview" class="w-full h-full object-contain transition-transform duration-300">
                </div>
            </label>
            <div class="page-actions absolute bottom-0 left-0 right-0 bg-black/60 flex justify-around items-center p-1 rounded-b-lg opacity-0 transition-opacity duration-300">
                <button title="Rotate Left" data-action="rotate-left" class="page-action-btn"><svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 15l-6 6m0 0l-6-6m6 6V9a6 6 0 0112 0v3" /></svg></button>
                <button title="Rotate Right" data-action="rotate-right" class="page-action-btn"><svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15l6 6m0 0l6-6m-6 6V9a6 6 0 00-12 0v3" /></svg></button>
                <button title="Flip Horizontal" data-action="flip-horizontal" class="page-action-btn"><svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16V8m-4 4h8m4 0l-3-3m3 3l-3 3M4 12l3-3m-3 3l3 3" /></svg></button>
            </div>
            <div class="absolute bottom-2 right-2 text-xs bg-black/50 text-white px-1.5 py-0.5 rounded">
                <span class="page-number-display"></span>
            </div>
        </div>
    </template>

    <script type="module">
        // --- PDF.js setup ---
        const { pdfjsLib } = globalThis;
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.3.136/pdf.worker.min.mjs`;

        // --- DOM ELEMENTS ---
        const dom = {
            uploaderView: document.getElementById('uploader-view'),
            editorView: document.getElementById('editor-view'),
            dropZone: document.getElementById('drop-zone'),
            fileSelectBtn: document.getElementById('file-select-btn'),
            fileInput: document.getElementById('file-input'),
            resetBtn: document.getElementById('reset-btn'),
            pagesGrid: document.getElementById('pages-grid'),
            pageCardTemplate: document.getElementById('page-card-template'),
            loaderOverlay: document.getElementById('loader-overlay'),
            loaderText: document.getElementById('loader-text'),
            // Controls
            formatSelect: document.getElementById('format-select'),
            qualityControl: document.getElementById('quality-control'),
            qualitySlider: document.getElementById('quality-slider'),
            qualityValue: document.getElementById('quality-value'),
            scaleSelect: document.getElementById('scale-select'),
            downloadSelectedBtn: document.getElementById('download-selected-btn'),
            downloadAllBtn: document.getElementById('download-all-btn'),
        };

        // --- STATE ---
        let appState = {
            pdfDoc: null,
            pages: new Map(), // pageNum -> { canvas, rotation, scaleX }
            isProcessing: false,
        };
        
        // --- UI TOGGLE ---
        const showLoader = (text) => {
            dom.loaderText.textContent = text;
            dom.loaderOverlay.classList.remove('hidden');
        };

        const hideLoader = () => {
            dom.loaderOverlay.classList.add('hidden');
        };

        const showEditor = () => {
            dom.uploaderView.classList.add('hidden');
            dom.editorView.classList.remove('hidden');
        };

        const resetUI = () => {
            dom.uploaderView.classList.remove('hidden');
            dom.editorView.classList.add('hidden');
            dom.pagesGrid.innerHTML = '';
            dom.fileInput.value = '';
            appState.pdfDoc = null;
            appState.pages.clear();
            updateDownloadButtons();
        };

        // --- FILE HANDLING ---
        const handleFileSelect = (file) => {
            if (!file || file.type !== 'application/pdf') {
                alert('Please select a valid PDF file.');
                return;
            }
            processPdf(file);
        };
        
        const processPdf = async (file) => {
            if (appState.isProcessing) return;
            appState.isProcessing = true;
            showLoader('Reading PDF...');
            
            const fileReader = new FileReader();
            fileReader.onload = async (e) => {
                const typedarray = new Uint8Array(e.target.result);
                try {
                    const pdfDoc = await pdfjsLib.getDocument({ data: typedarray }).promise;
                    appState.pdfDoc = pdfDoc;
                    showEditor();
                    await renderAllPages();
                } catch (error) {
                    alert(`Error processing PDF: ${error.message}`);
                    resetUI();
                } finally {
                    hideLoader();
                    appState.isProcessing = false;
                }
            };
            fileReader.readAsArrayBuffer(file);
        };
        
        const renderAllPages = async () => {
            if (!appState.pdfDoc) return;
            const numPages = appState.pdfDoc.numPages;
            showLoader(`Rendering ${numPages} pages...`);

            const scale = parseFloat(dom.scaleSelect.value);

            for (let i = 1; i <= numPages; i++) {
                dom.loaderText.textContent = `Rendering page ${i} of ${numPages}...`;
                const canvas = await renderPageToCanvas(i, scale);
                
                const card = dom.pageCardTemplate.content.cloneNode(true);
                const pageCard = card.querySelector('.page-card');
                const img = card.querySelector('img');
                const pageNumDisplay = card.querySelector('.page-number-display');
                
                pageCard.dataset.pageNum = i;
                img.src = canvas.toDataURL();
                pageNumDisplay.textContent = i;
                
                dom.pagesGrid.appendChild(card);
                
                appState.pages.set(i, { canvas, rotation: 0, scaleX: 1 });
            }
            updateDownloadButtons();
            hideLoader();
        };
        
        const renderPageToCanvas = async (pageNum, scale) => {
            const page = await appState.pdfDoc.getPage(pageNum);
            const viewport = page.getViewport({ scale });
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            await page.render({ canvasContext: context, viewport: viewport }).promise;
            return canvas;
        };

        // --- PAGE ACTIONS ---
        const handlePageAction = (e) => {
            const button = e.target.closest('.page-action-btn');
            if (!button) return;
            
            const card = e.target.closest('.page-card');
            const pageNum = parseInt(card.dataset.pageNum, 10);
            const action = button.dataset.action;
            const pageData = appState.pages.get(pageNum);
            if (!pageData) return;

            if (action === 'rotate-left') pageData.rotation = (pageData.rotation - 90) % 360;
            if (action === 'rotate-right') pageData.rotation = (pageData.rotation + 90) % 360;
            if (action === 'flip-horizontal') pageData.scaleX *= -1;
            
            updatePreviewTransform(card, pageData);
        };
        
        const updatePreviewTransform = (card, pageData) => {
            const img = card.querySelector('img');
            img.style.transform = `rotate(${pageData.rotation}deg) scaleX(${pageData.scaleX})`;
        };
        
        // --- UI CONTROLS & UPDATES ---
        const updateDownloadButtons = () => {
            const anyPageExists = appState.pages.size > 0;
            dom.downloadAllBtn.disabled = !anyPageExists;
            
            const anySelected = dom.pagesGrid.querySelector('.page-card-checkbox:checked');
            dom.downloadSelectedBtn.disabled = !anySelected;
        };
        
        const handleFormatChange = () => {
            const format = dom.formatSelect.value;
            dom.qualityControl.classList.toggle('hidden', format === 'image/png');
        };

        // --- DOWNLOAD LOGIC ---
        const handleDownload = async (all = false) => {
            if (appState.isProcessing) return;
            appState.isProcessing = true;
            
            const selectedPages = all 
                ? Array.from(appState.pages.keys())
                : [...dom.pagesGrid.querySelectorAll('.page-card-checkbox:checked')].map(cb => parseInt(cb.closest('.page-card').dataset.pageNum, 10));

            if (selectedPages.length === 0) {
                alert('No pages selected for download.');
                appState.isProcessing = false;
                return;
            }

            showLoader('Preparing ZIP file...');
            
            const zip = new JSZip();
            const format = dom.formatSelect.value;
            const quality = parseFloat(dom.qualitySlider.value);
            const extension = format.split('/')[1];

            for (const pageNum of selectedPages) {
                dom.loaderText.textContent = `Processing page ${pageNum}...`;
                const pageData = appState.pages.get(pageNum);
                
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                
                const { canvas, rotation, scaleX } = pageData;
                
                const w = canvas.width;
                const h = canvas.height;
                
                const rotated = (rotation % 180 !== 0);
                tempCanvas.width = rotated ? h : w;
                tempCanvas.height = rotated ? w : h;

                tempCtx.translate(tempCanvas.width / 2, tempCanvas.height / 2);
                tempCtx.rotate(rotation * Math.PI / 180);
                tempCtx.scale(scaleX, 1);
                
                tempCtx.drawImage(canvas, -w / 2, -h / 2);

                const blob = await new Promise(resolve => tempCanvas.toBlob(resolve, format, quality));
                zip.file(`page-${pageNum}.${extension}`, blob);
            }
            
            showLoader('Generating download...');
            const zipBlob = await zip.generateAsync({ type: 'blob' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(zipBlob);
            link.download = `converted-pages_${Date.now()}.zip`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            hideLoader();
            appState.isProcessing = false;
        };
        
        // --- EVENT LISTENERS ---
        const setupEventListeners = () => {
            // Uploader
            dom.fileSelectBtn.addEventListener('click', () => dom.fileInput.click());
            dom.fileInput.addEventListener('change', (e) => handleFileSelect(e.target.files[0]));
            
            // Drag and Drop
            const dropZone = dom.dropZone;
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('border-primary', 'bg-primary/5');
            });
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-primary', 'bg-primary/5');
            });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-primary', 'bg-primary/5');
                handleFileSelect(e.dataTransfer.files[0]);
            });

            // Controls
            dom.resetBtn.addEventListener('click', resetUI);
            dom.formatSelect.addEventListener('change', handleFormatChange);
            dom.qualitySlider.addEventListener('input', () => dom.qualityValue.textContent = dom.qualitySlider.value);
            dom.downloadSelectedBtn.addEventListener('click', () => handleDownload(false));
            dom.downloadAllBtn.addEventListener('click', () => handleDownload(true));
            
            // Event delegation for dynamic content
            dom.pagesGrid.addEventListener('click', (e) => {
                if (e.target.matches('.page-card-checkbox')) {
                    updateDownloadButtons();
                } else {
                    handlePageAction(e);
                }
            });
            
            // Re-render pages if scale is changed (optional, can be complex)
            // For simplicity, this is not implemented. User should choose scale before loading.
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
        });

    </script>
</body>
</html>
