<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VEO Prompt Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.0",
    "react-dom/client": "https://esm.sh/react-dom@^19.1.0/client",
    "react-dropzone": "https://esm.sh/react-dropzone@^14.3.8",
    "react-dom/": "https://esm.sh/react-dom@^19.1.1/",
    "react/": "https://esm.sh/react@^19.1.1/"
  }
}
</script>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef } from 'react';
      import ReactDOM from 'react-dom/client';

      // --- START: Icon Components ---

      const ChevronDownIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M19 9l-7 7-7-7" />
        </svg>
      );

      const ChevronUpIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M5 15l7-7 7 7" />
        </svg>
      );

      const ClipboardIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
        </svg>
      );

      const DownloadIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
        </svg>
      );

      const PlusIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" />
        </svg>
      );
      
      const TrashIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      );

      // --- END: Icon Components ---


      // --- START: UI Components ---
      
      const Select = ({ label, options, ...props }) => (
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
          <select
            {...props}
            className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#da3f0b] focus:border-[#da3f0b] sm:text-sm"
          >
            {options.map(option => (
              <option key={option.value} value={option.value}>{option.label}</option>
            ))}
          </select>
        </div>
      );

      const Slider = ({ label, value, minLabel, maxLabel, ...props }) => (
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
          <div className="flex items-center gap-4">
            <input
              type="range"
              {...props}
              value={value}
              className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-[#da3f0b]"
            />
            <span className="text-sm font-semibold text-gray-800 w-12 text-center">{value}</span>
          </div>
          {(minLabel || maxLabel) && (
            <div className="flex justify-between text-xs text-gray-500 mt-1">
              <span>{minLabel}</span>
              <span>{maxLabel}</span>
            </div>
          )}
        </div>
      );
      
      // --- END: UI Components ---


      // --- START: Main Components ---

      const JsonPreview = ({ shots, templateType }) => {
        const [jsonString, setJsonString] = useState('');
        const [copyStatus, setCopyStatus] = useState('idle');

        useEffect(() => {
          const generateJson = () => {
            const exportShots = shots.map(({ id, ...rest }) => rest);
            const output = templateType === 'Video' 
              ? { shots: exportShots }
              : exportShots[0] || {};
            
            return JSON.stringify(output, null, 2);
          };
          setJsonString(generateJson());
        }, [shots, templateType]);

        const handleCopy = () => {
          navigator.clipboard.writeText(jsonString).then(() => {
            setCopyStatus('copied');
            setTimeout(() => setCopyStatus('idle'), 2000);
          });
        };

        const handleDownload = () => {
          const blob = new Blob([jsonString], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'prompt.json';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        };

        return (
          <div className="bg-white rounded-xl shadow-md p-6 flex flex-col h-full sticky top-6">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-xl font-bold text-gray-800">Live JSON Preview</h2>
              <div className="flex items-center gap-2">
                <button onClick={handleCopy} className="p-2 rounded-md hover:bg-gray-100 transition-colors text-gray-600" title="Copy to Clipboard">
                  {copyStatus === 'idle' ? <ClipboardIcon className="w-5 h-5" /> : <span className="text-sm font-semibold text-[#da3f0b]">Copied!</span>}
                </button>
                <button onClick={handleDownload} className="p-2 rounded-md hover:bg-gray-100 transition-colors text-gray-600" title="Download JSON">
                  <DownloadIcon className="w-5 h-5" />
                </button>
              </div>
            </div>
            <div className="flex-grow bg-gray-900 text-white rounded-lg p-4 overflow-auto font-mono text-sm">
              <pre><code>{jsonString}</code></pre>
            </div>
          </div>
        );
      };

      const Section = ({ title, children }) => (
        <div className="space-y-4">
          <h3 className="text-lg font-semibold text-gray-800 border-b pb-2">{title}</h3>
          {children}
        </div>
      );

      const ShotEditor = ({ shot, index, totalShots, updateShot, removeShot, moveShot }) => {
        const [isCollapsed, setIsCollapsed] = useState(false);

        const PRESETS = {
          "Noir City": "A rainy noir city at midnight, cinematic, high contrast, shadows, neon signs reflecting on wet pavement.",
          "Fantasy Forest": "An enchanted forest, bioluminescent mushrooms, ancient trees with glowing runes, ethereal mist, fantasy art style.",
          "Product Macro": "Macro shot of a luxury watch, clean studio lighting, sharp focus, high detail, product photography.",
        };

        const SAFETY_NEGATIVES = "blurry, distorted, low resolution, watermark, ugly, tiling, poorly drawn hands, poorly drawn feet, poorly drawn face, out of frame, extra limbs, disfigured, deformed, body out of frame, bad anatomy, blurred, grainy, signature, cut off, draft";

        const handleChange = (field, value) => {
          updateShot(shot.id, field, value);
        };

        const handlePreset = (presetValue) => {
          const newValue = shot.scene ? `${shot.scene}, ${presetValue}` : presetValue;
          handleChange('scene', newValue);
        };
        
        const handleAddSafetyNegatives = () => {
          const newValue = shot.negativePrompt ? `${shot.negativePrompt}, ${SAFETY_NEGATIVES}` : SAFETY_NEGATIVES;
          handleChange('negativePrompt', newValue);
        };
        
        return (
          <div className="bg-white rounded-xl shadow-md p-6 space-y-6">
            <div className="flex justify-between items-center">
              <div className="flex items-center gap-4">
                <h2 className="text-xl font-bold text-gray-800">
                  Shot #{index + 1}
                </h2>
                <button onClick={() => setIsCollapsed(!isCollapsed)} className="text-gray-500 hover:text-gray-800">
                  {isCollapsed ? 'Show' : 'Hide'} Details
                </button>
              </div>
              <div className="flex items-center gap-2">
                 <button onClick={() => moveShot(index, 'up')} disabled={index === 0} className="p-2 rounded-md hover:bg-gray-100 disabled:opacity-30 disabled:cursor-not-allowed">
                  <ChevronUpIcon className="w-5 h-5" />
                </button>
                <button onClick={() => moveShot(index, 'down')} disabled={index === totalShots - 1} className="p-2 rounded-md hover:bg-gray-100 disabled:opacity-30 disabled:cursor-not-allowed">
                  <ChevronDownIcon className="w-5 h-5" />
                </button>
                <button onClick={() => removeShot(shot.id)} className="p-2 rounded-md text-red-500 hover:bg-red-50" disabled={totalShots <= 1}>
                  <TrashIcon className="w-5 h-5" />
                </button>
              </div>
            </div>
            
            {!isCollapsed && (
              <div className="space-y-8">
                <Section title="Scene Setting">
                  <textarea
                    value={shot.scene}
                    onChange={(e) => handleChange('scene', e.target.value)}
                    placeholder="e.g., A futuristic city with flying cars"
                    className="w-full h-24 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#da3f0b] focus:border-[#da3f0b]"
                  />
                  <div className="flex flex-wrap gap-2">
                    {Object.entries(PRESETS).map(([name, value]) => (
                      <button key={name} onClick={() => handlePreset(value)} className="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200">
                        {name}
                      </button>
                    ))}
                  </div>
                </Section>
                
                <Section title="Negative Prompts">
                   <textarea
                    value={shot.negativePrompt}
                    onChange={(e) => handleChange('negativePrompt', e.target.value)}
                    placeholder="e.g., blurry, distorted faces"
                    className="w-full h-20 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#da3f0b] focus:border-[#da3f0b]"
                  />
                  <button onClick={handleAddSafetyNegatives} className="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200">
                    Add Default Safety Negatives
                  </button>
                </Section>

                <Section title="Shot Configuration">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <Select label="Camera Angle" value={shot.cameraAngle} onChange={e => handleChange('cameraAngle', e.target.value)} options={[
                        {value: 'wide', label: 'Wide'}, {value: 'pov', label: 'Point of View'}, {value: 'drone', label: 'Drone'}, {value: 'close-up', label: 'Close-up'}, {value: 'eye-level', label: 'Eye-level'}
                    ]}/>
                    <Select label="Camera Movement" value={shot.cameraMovement} onChange={e => handleChange('cameraMovement', e.target.value)} options={[
                        {value: 'static', label: 'Static'}, {value: 'pan', label: 'Pan'}, {value: 'dolly', label: 'Dolly'}, {value: 'tilt', label: 'Tilt'}, {value: 'zoom', label: 'Zoom'}
                    ]}/>
                    <Select label="Lighting" value={shot.lighting} onChange={e => handleChange('lighting', e.target.value)} options={[
                        {value: 'natural', label: 'Natural'}, {value: 'cinematic', label: 'Cinematic'}, {value: 'neon', label: 'Neon'}, {value: 'softbox', label: 'Softbox'}, {value: 'dramatic', label: 'Dramatic'}
                    ]}/>
                    <Select label="Aspect Ratio" value={shot.aspectRatio} onChange={e => handleChange('aspectRatio', e.target.value)} options={[
                        {value: '16:9', label: '16:9'}, {value: '9:16', label: '9:16'}, {value: '1:1', label: '1:1'}, {value: '4:3', label: '4:3'}
                    ]}/>
                    <Select label="Resolution" value={shot.resolution} onChange={e => handleChange('resolution', e.target.value)} options={[
                        {value: '720p', label: '720p'}, {value: '1080p', label: '1080p'}, {value: '4K', label: '4K'}
                    ]}/>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 pt-4">
                    <Slider label="Duration (seconds)" value={shot.duration} onChange={e => handleChange('duration', parseInt(e.target.value))} min={1} max={30} />
                    <Slider label="Frame Rate (fps)" value={shot.frameRate} onChange={e => handleChange('frameRate', parseInt(e.target.value))} min={12} max={60} step={1} />
                    <Slider label="Contrast" value={shot.contrast} onChange={e => handleChange('contrast', parseInt(e.target.value))} min={0} max={100} />
                    <Slider label="Saturation" value={shot.saturation} onChange={e => handleChange('saturation', parseInt(e.target.value))} min={0} max={100} />
                    <Slider label="Color Grading" value={shot.colorGrading} onChange={e => handleChange('colorGrading', parseInt(e.target.value))} min={-100} max={100} minLabel="Cool" maxLabel="Warm"/>
                  </div>
                </Section>

                <Section title="Shot Notes">
                  <textarea
                      value={shot.notes}
                      onChange={(e) => handleChange('notes', e.target.value)}
                      placeholder="Client wants warmer tones..."
                      className="w-full h-20 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#da3f0b] focus:border-[#da3f0b]"
                  />
                </Section>
              </div>
            )}
          </div>
        );
      };


      // --- END: Main Components ---


      // --- START: App ---

      const createNewShot = () => ({
        id: Date.now(),
        scene: '',
        negativePrompt: '',
        cameraAngle: 'wide',
        cameraMovement: 'static',
        lighting: 'natural',
        aspectRatio: '16:9',
        resolution: '1080p',
        duration: 5,
        frameRate: 24,
        contrast: 50,
        saturation: 50,
        colorGrading: 0,
        notes: '',
      });

      const App = () => {
        const [shots, setShots] = useState([createNewShot()]);
        const [templateType, setTemplateType] = useState('Video');

        const addShot = () => {
          setShots(prev => [...prev, createNewShot()]);
        };

        const removeShot = (id) => {
          setShots(prev => prev.length > 1 ? prev.filter(shot => shot.id !== id) : prev);
        };
        
        const updateShot = (id, field, value) => {
          setShots(prev => prev.map(shot => shot.id === id ? { ...shot, [field]: value } : shot));
        };
        
        const moveShot = (index, direction) => {
          if (direction === 'up' && index === 0) return;
          if (direction === 'down' && index === shots.length - 1) return;

          const newShots = [...shots];
          const shotToMove = newShots[index];
          const swapIndex = direction === 'up' ? index - 1 : index + 1;
          newShots[index] = newShots[swapIndex];
          newShots[swapIndex] = shotToMove;
          setShots(newShots);
        };
        
        const isImageTemplate = templateType === 'Image';

        return (
          <div className="min-h-screen p-4 md:p-8">
            <main className="w-full max-w-7xl mx-auto">
              <div className="text-center mb-8">
                  <h1 className="text-3xl md:text-4xl font-bold text-gray-800">VEO Prompt Builder</h1>
                  <p className="text-gray-500 mt-2">Visually construct and export prompts for video generation models.</p>
              </div>
              
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                {/* Left Column: Editors */}
                <div className="space-y-6">
                  <div className="bg-white rounded-xl shadow-md p-6">
                      <h2 className="text-xl font-bold text-gray-800 mb-4">Global Settings</h2>
                      <div className="flex items-center gap-4">
                        <label className="font-medium">Template:</label>
                        <div className="flex rounded-lg p-1 bg-gray-100">
                          <button onClick={() => setTemplateType('Video')} className={`px-4 py-1 text-sm font-semibold rounded-md transition-colors ${templateType === 'Video' ? 'bg-[#da3f0b] text-white' : 'text-gray-600'}`}>Video</button>
                          <button onClick={() => setTemplateType('Image')} className={`px-4 py-1 text-sm font-semibold rounded-md transition-colors ${templateType === 'Image' ? 'bg-[#da3f0b] text-white' : 'text-gray-600'}`}>Image</button>
                        </div>
                      </div>
                       {isImageTemplate && <p className="text-sm text-gray-500 mt-2">Image mode uses only the first shot.</p>}
                  </div>

                  {isImageTemplate ? (
                    <ShotEditor
                      key={shots[0].id}
                      shot={shots[0]}
                      index={0}
                      totalShots={1}
                      updateShot={updateShot}
                      removeShot={removeShot}
                      moveShot={moveShot}
                    />
                  ) : (
                    shots.map((shot, index) => (
                      <ShotEditor
                        key={shot.id}
                        shot={shot}
                        index={index}
                        totalShots={shots.length}
                        updateShot={updateShot}
                        removeShot={removeShot}
                        moveShot={moveShot}
                      />
                    ))
                  )}

                  {!isImageTemplate && (
                    <button
                      onClick={addShot}
                      className="w-full flex items-center justify-center gap-2 px-6 py-3 border-2 border-dashed border-gray-300 text-gray-600 font-semibold rounded-lg hover:bg-gray-100 hover:border-gray-400 transition-colors"
                    >
                      <PlusIcon className="w-5 h-5" />
                      Add Another Shot
                    </button>
                  )}
                </div>

                {/* Right Column: JSON Preview */}
                <div className="w-full">
                  <JsonPreview shots={isImageTemplate ? [shots[0]] : shots} templateType={templateType} />
                </div>
              </div>
            </main>
          </div>
        );
      };

      // --- END: App ---


      // --- START: Render ---

      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );

      // --- END: Render ---

    </script>
  </body>
</html>
